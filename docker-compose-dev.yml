version: '2'

services:
    nginx: 
        restart: unless-stopped
        build:
            context: .
            dockerfile: ./docker/nginx/development/Dockerfile
        ports:
            - 80:80
        volumes:
            - static_volume:/app/backend/server/django_static
            - ./docker/nginx/development:/etc/nginx/conf.d
        depends_on: 
            - backend
    backend:
        restart: unless-stopped
        build:
            context: .
            dockerfile: ./docker/backend/Dockerfile
        environment:
            - DJANGO_SETTINGS_MODULE=brawlbackend.settings.dev_settings
        command: python manage.py runserver 0.0.0.0:8000
        volumes:
            - .:/app:delegated
            - static_volume:/app/backend/server/django_static
        expose:
            - 8000        
    frontend:
        container_name: frontend
        ports:
            - "3000:3080"
        build:
            context: ./
            dockerfile: ./docker/frontend/Dockerfile
        volumes:
            - ./frontend:/app:delegated
            - /app/node_modules
        environment:
            - NODE_ENV=development
            - CHOKIDAR_USEPOLLING=true
        command: npm start

volumes:
    static_volume: {}